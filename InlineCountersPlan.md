# Inline Counters Plan

## Контекст
Добавляем инлайн-счётчики количества обедов по дням, чтобы пользователь мог управлять заказом в одном сообщении без раскрывающихся состояний.

## Задачи

### 1. Управление состоянием заказа
- Создать структуру `context.user_data["bulk_order"]`, в которой для каждой даты хранится статус выбора и количество.
- Инициализировать и очищать состояние при входе/выходе из шага выбора дней, синхронизировать с текущим черновиком заказа.
- Подготовить вспомогательные функции (например, `get_bulk_order_state`, `reset_bulk_order_state`) для повторного использования.

**Зависимости:** нет.

### 2. Пересборка клавиатуры выбора дней
- В `keyboards.py` реализовать генератор инлайн-клавиатуры со строками вида `[Понедельник] [-] [число] [+]`.
- Добавить общие кнопки: «Выбрать всё», «Снять всё», «Продолжить», «Отмена».
- Обеспечить единый источник текстов кнопок, чтобы админский и пользовательский режим получали одну и ту же версию подписи.

**Зависимости:** задача 1.

### 3. Обработчики callback’ов
- Добавить обработку callback data для выбора дня, инкремента/декремента и массовых действий.
- Реализовать проверки на минимальное значение (0) и возможный максимум (если задан); при ошибке показывать уведомление пользователю.
- Использовать `editMessageReplyMarkup` для пересборки клавиатуры на каждое действие, чтобы счётчики сразу отражали новое состояние.

**Зависимости:** задачи 1–2.

### 4. Обновление пользовательского потока заказа
- При переходе к подтверждению собирать итоговое количество и формировать сводку по выбранным дням.
- Сохранить итоговые данные в черновик заказа, чтобы дальнейшие шаги (дубликаты, подтверждение) работали с новыми полями.
- Обновить обработчики дубликатов, чтобы они учитывали количество по каждому дню.

**Зависимости:** задача 3.

### 5. Логирование и отчётность
- Включить новые callback-метки в `log_button` и другие точки аудита.
- Скорректировать отчёты администратора и сохранение заказов, чтобы количество обедов использовалось в расчётах и отображении.

**Зависимости:** задача 4.

### 6. Тестирование сценариев
- Пройти пользовательский поток: выбор нескольких дней с разными количествами, массовые действия, изменение количества перед подтверждением, отмена.
- Проверить админские сценарии: просмотр отчётов, изменение заказа, обработка дубликатов.
- Зафиксировать найденные баги и уточнения для последующих итераций.

**Зависимости:** задача 5.

Progress: Task 1 — Управление состоянием заказа — Done.
Progress: Task 2 — Пересборка клавиатуры выбора дней — Done.
Progress: Task 3 — Обработчики callback’ов — Done.
Progress: Task 4 — Обновление пользовательского потока заказа — Done.
Progress: Task 5 — Логирование и отчётность — Done.
Progress: Task 6 — Тестирование сценариев — Done.
